let canThrow = true; // 是否允許丟蛋糕

function spawnCake(x) {
  if (!canThrow) return; // 如果還在冷卻中就不丟
  canThrow = false;      // 丟出去後進入冷卻

  const cake = document.createElement('div');
  cake.className = 'cake';
  cake.style.left = (x - 30) + 'px';
  cake.style.top = '380px';
  game.appendChild(cake);

  // 播放丟蛋糕音效
  throwSound.currentTime = 0;
  throwSound.play();

  setTimeout(() => {
    cake.style.top = '0px';
  }, 20);

  // 碰撞檢查
  let checkHit = setInterval(() => {
    const cakeRect = cake.getBoundingClientRect();
    const targetRect = target.getBoundingClientRect();

    if (!(cakeRect.bottom < targetRect.top || 
          cakeRect.top > targetRect.bottom || 
          cakeRect.right < targetRect.left || 
          cakeRect.left > targetRect.right)) {
      score++;
      scoreDisplay.textContent = '得分：' + score;

      // 播放砸中音效
      hitSound.currentTime = 0;
      hitSound.play();

      clearInterval(checkHit);
      cake.remove();
      canThrow = true; // 允許再丟下一顆
    }
  }, 50);

  // 移除蛋糕 & 解除冷卻
  setTimeout(() => {
    clearInterval(checkHit);
    cake.remove();
    canThrow = true; // 飛完沒打中也要恢復丟蛋糕
  }, 1200);
}
